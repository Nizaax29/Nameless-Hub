--[[ 
  NMX HUB - LocalScript (place in StarterPlayer > StarterPlayerScripts)
  - UI animated, draggable NMX button
  - Tabs scrollable (left), Main scrollable (right)
  - Vertical slide between Main <-> Discord
  - Buttons: Walk To Base, Tween To Base, ESP, Auto-Die, Auto Kick, Copy Discord Link
  - Safe: server-sensitive actions are NOT performed from client. Adapt server-side if needed.
--]]

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
if not player then return end

-- Helper style
local function applyNeon(instance, thickness)
	thickness = thickness or 2
	local c = Instance.new("UICorner", instance)
	c.CornerRadius = UDim.new(0, 8)
	local s = Instance.new("UIStroke", instance)
	s.Color = Color3.fromRGB(0, 200, 255)
	s.Thickness = thickness
end

-- Root ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NMXHub_UI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- ===== NMX BUTTON (small, square, draggable) =====
local nmxBtn = Instance.new("TextButton")
nmxBtn.Name = "NMXButton"
nmxBtn.Size = UDim2.new(0, 46, 0, 46)
nmxBtn.Position = UDim2.new(0.5, -23, 0.06, 0)
nmxBtn.AnchorPoint = Vector2.new(0,0)
nmxBtn.BackgroundColor3 = Color3.fromRGB(12,12,12)
nmxBtn.AutoButtonColor = false
nmxBtn.Font = Enum.Font.GothamBold
nmxBtn.Text = "NMX"
nmxBtn.TextColor3 = Color3.fromRGB(0,220,255)
nmxBtn.TextScaled = true
applyNeon(nmxBtn, 2)
nmxBtn.Parent = screenGui

-- Drag behavior (robust)
do
	local dragging, dragStart, startPos, dragInput
	nmxBtn.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = nmxBtn.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	nmxBtn.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if dragInput == input and dragging then
			local delta = input.Position - dragStart
			nmxBtn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- ===== HUB FRAME (hidden, slides in) =====
local hub = Instance.new("Frame")
hub.Name = "NMXHub"
hub.Size = UDim2.new(0, 520, 0, 380)
hub.Position = UDim2.new(0.5, -260, -1.2, 0) -- hidden above
hub.AnchorPoint = Vector2.new(0,0)
hub.BackgroundColor3 = Color3.fromRGB(18,18,18)
hub.BorderSizePixel = 0
applyNeon(hub, 3)
hub.Parent = screenGui

local hubCorner = Instance.new("UICorner", hub)
hubCorner.CornerRadius = UDim.new(0, 12)

local hubTitle = Instance.new("TextLabel", hub)
hubTitle.Size = UDim2.new(1,0,0,48)
hubTitle.Position = UDim2.new(0,0,0,0)
hubTitle.BackgroundTransparency = 1
hubTitle.Text = "NMX HUB (Studio)"
hubTitle.TextColor3 = Color3.fromRGB(0,220,255)
hubTitle.Font = Enum.Font.GothamBold
hubTitle.TextScaled = true

-- Left: Tabs Scroll (vertical)
local tabsScroll = Instance.new("ScrollingFrame", hub)
tabsScroll.Name = "TabsScroll"
tabsScroll.Size = UDim2.new(0, 140, 1, -70)
tabsScroll.Position = UDim2.new(0, 10, 0, 60)
tabsScroll.BackgroundTransparency = 1
tabsScroll.BorderSizePixel = 0
tabsScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
tabsScroll.ScrollBarThickness = 6
local tabsLayout = Instance.new("UIListLayout", tabsScroll)
tabsLayout.Padding = UDim.new(0,8)
tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Right: Viewport for pages (clips children)
local viewport = Instance.new("Frame", hub)
viewport.Size = UDim2.new(1, -170, 1, -70)
viewport.Position = UDim2.new(0, 160, 0, 60)
viewport.BackgroundTransparency = 1
viewport.ClipsDescendants = true

-- Pages: stacked vertically (for vertical slide)
local pageMain = Instance.new("Frame", viewport)
pageMain.Size = UDim2.new(1, 0, 1, 0)
pageMain.Position = UDim2.new(0, 0, 0, 0)
pageMain.BackgroundTransparency = 1

local pageDiscord = Instance.new("Frame", viewport)
pageDiscord.Size = UDim2.new(1, 0, 1, 0)
pageDiscord.Position = UDim2.new(0, 0, 1, 0) -- below viewport
pageDiscord.BackgroundTransparency = 1

-- Tab creator helper
local function makeTabBtn(name)
	local b = Instance.new("TextButton")
	b.Size = UDim2.new(1, -12, 0, 48)
	b.BackgroundColor3 = Color3.fromRGB(25,25,25)
	b.Text = name
	b.Font = Enum.Font.GothamBold
	b.TextSize = 14
	b.TextColor3 = Color3.fromRGB(0,220,255)
	b.AutoButtonColor = false
	applyNeon(b,1)
	b.Parent = tabsScroll
	return b
end

local mainTab = makeTabBtn("MAIN")
local discordTab = makeTabBtn("DISCORD")

-- Slide vertical function
local slideTime = 0.28
local currentPage = "Main"
local function slideTo(target)
	if target == currentPage then return end
	currentPage = target
	if target == "Discord" then
		TweenService:Create(pageMain, TweenInfo.new(slideTime, Enum.EasingStyle.Quad), {Position = UDim2.new(0,0,-1,0)}):Play()
		TweenService:Create(pageDiscord, TweenInfo.new(slideTime, Enum.EasingStyle.Quad), {Position = UDim2.new(0,0,0,0)}):Play()
	else
		TweenService:Create(pageMain, TweenInfo.new(slideTime, Enum.EasingStyle.Quad), {Position = UDim2.new(0,0,0,0)}):Play()
		TweenService:Create(pageDiscord, TweenInfo.new(slideTime, Enum.EasingStyle.Quad), {Position = UDim2.new(0,0,1,0)}):Play()
	end
end

mainTab.MouseButton1Click:Connect(function() slideTo("Main") end)
discordTab.MouseButton1Click:Connect(function() slideTo("Discord") end)

-- Ensure visible states
pageMain.Visible = true
pageDiscord.Visible = true
currentPage = "Main"

-- ===== Main page: scroll + buttons =====
local mainScroll = Instance.new("ScrollingFrame", pageMain)
mainScroll.Size = UDim2.new(1, 0, 1, 0)
mainScroll.Position = UDim2.new(0,0,0,0)
mainScroll.BackgroundTransparency = 1
mainScroll.BorderSizePixel = 0
mainScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
mainScroll.ScrollBarThickness = 6
local mainLayout = Instance.new("UIListLayout", mainScroll)
mainLayout.SortOrder = Enum.SortOrder.LayoutOrder
mainLayout.Padding = UDim.new(0,10)

local function makeMainBtn(text)
	local b = Instance.new("TextButton", mainScroll)
	b.Size = UDim2.new(1, -20, 0, 44)
	b.BackgroundColor3 = Color3.fromRGB(24,24,24)
	b.TextColor3 = Color3.fromRGB(0,220,255)
	b.Font = Enum.Font.GothamBold
	b.Text = text
	b.TextSize = 14
	b.AutoButtonColor = false
	applyNeon(b,1)
	local c = b:FindFirstChildOfClass("UICorner")
	if c then c.CornerRadius = UDim.new(0,6) end
	return b
end

-- Buttons (clean labels)
local walkBtn = makeMainBtn("Walk To Base")
local tweenBtn = makeMainBtn("Tween To Base")
local kickBtn = makeMainBtn("Auto Kick : OFF")
local espBtn = makeMainBtn("ESP : OFF")
local antiDieBtn = makeMainBtn("Anti Die : OFF")

-- ===== Discord page content (copy link) =====
local discordLayout = Instance.new("UIListLayout", pageDiscord)
discordLayout.Padding = UDim.new(0,12)
discordLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
discordLayout.VerticalAlignment = Enum.VerticalAlignment.Top

local spacer = Instance.new("Frame", pageDiscord)
spacer.Size = UDim2.new(1,0,0,8)
spacer.BackgroundTransparency = 1

local copyBtn = Instance.new("TextButton", pageDiscord)
copyBtn.Size = UDim2.new(0, 380, 0, 44)
copyBtn.Position = UDim2.new(0.5, -190, 0, 20)
copyBtn.AnchorPoint = Vector2.new(0.5,0)
copyBtn.BackgroundColor3 = Color3.fromRGB(24,24,24)
copyBtn.TextColor3 = Color3.fromRGB(0,220,255)
copyBtn.Font = Enum.Font.GothamBold
copyBtn.Text = "Copy The Link"
copyBtn.TextSize = 14
copyBtn.AutoButtonColor = false
applyNeon(copyBtn,1)

copyBtn.MouseButton1Click:Connect(function()
	pcall(function() setclipboard("https://discord.gg/r7CCPpUTth") end)
	local prev = copyBtn.Text
	copyBtn.Text = "Copied !"
	task.delay(1.2, function() copyBtn.Text = prev end)
end)

-- ========== Feature implementations (safe / for Studio) ==========

-- Helper: find your base (works with 'Plots' folder like earlier)
local function findMyBase()
	local plots = workspace:FindFirstChild("Plots")
	if not plots then return nil end
	for _, plot in pairs(plots:GetChildren()) do
		local sign = plot:FindFirstChild("PlotSign")
		if sign and sign:FindFirstChild("YourBase") and sign.YourBase.Enabled then
			local hit = plot:FindFirstChild("DeliveryHitbox")
			if hit and hit:IsA("BasePart") then
				return hit
			end
		end
	end
	return nil
end

-- WalkToBase (uses Humanoid:MoveTo)
walkBtn.MouseButton1Click:Connect(function()
	local char = player.Character
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid")
	if not humanoid then return end
	local target = findMyBase()
	if target then
		humanoid:MoveTo(target.Position)
	else
		walkBtn.Text = "Base not found (place Plots/YourBase)"
		task.delay(1.4, function() walkBtn.Text = "Walk To Base" end)
	end
end)

-- Tween to base: smooth tween on HumanoidRootPart CFrame (client-side only)
tweenBtn.MouseButton1Click:Connect(function()
	local char = player.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	local target = findMyBase()
	if not target then
		tweenBtn.Text = "Base not found"
		task.delay(1.2, function() tweenBtn.Text = "Tween To Base" end)
		return
	end
	local startC = hrp.CFrame
	local goalC = CFrame.new(target.Position + Vector3.new(0, 6, 0))
	local distance = (startC.Position - goalC.Position).Magnitude
	local speed = 20 -- studs/sec
	local duration = math.max(0.2, distance / speed)
	local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Linear)
	local tween = TweenService:Create(hrp, tweenInfo, {CFrame = goalC})
	tween:Play()
end)

-- Auto Kick: CLIENT SAFE -> only shows visual notification; if you want server kick implement server RemoteEvent
local autoKickEnabled = false
kickBtn.MouseButton1Click:Connect(function()
	autoKickEnabled = not autoKickEnabled
	kickBtn.Text = autoKickEnabled and "Auto Kick : ON" or "Auto Kick : OFF"
end)

task.spawn(function()
	while task.wait(1) do
		if autoKickEnabled then
			for _, g in pairs(player.PlayerGui:GetDescendants()) do
				if (g:IsA("TextLabel") or g:IsA("TextButton") or g:IsA("TextBox")) and type(g.Text) == "string" then
					if string.find(string.lower(g.Text), "you stole") then
						-- SAFE: only notify via UI; DO NOT call player:Kick from client
						kickBtn.Text = "Detected 'you stole' in GUI"
						task.delay(1.5, function()
							if autoKickEnabled then kickBtn.Text = "Auto Kick : ON" else kickBtn.Text = "Auto Kick : OFF" end
						end)
					end
				end
			end
		end
	end
end)

-- ESP: safe mode - highlights parts named "ESPTarget" and players if desired (uses SelectionBox - local)
local espEnabled = false
local espHighlights = {}

local function addHighlightObject(obj)
	if not obj or not obj:IsA("BasePart") then return end
	if espHighlights[obj] then return end
	local box = Instance.new("SelectionBox")
	box.Adornee = obj
	box.LineThickness = 0.02
	box.Color3 = Color3.fromRGB(0,200,255)
	box.Parent = obj
	espHighlights[obj] = box
end

local function clearEspHighlights()
	for k, v in pairs(espHighlights) do
		pcall(function() v:Destroy() end)
	end
	espHighlights = {}
end

espBtn.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	espBtn.Text = espEnabled and "ESP : ON" or "ESP : OFF"
	if espEnabled then
		-- highlight all parts named "ESPTarget" in workspace
		for _, obj in pairs(workspace:GetDescendants()) do
			if obj:IsA("BasePart") and obj.Name == "ESPTarget" then
				addHighlightObject(obj)
			end
		end
	else
		clearEspHighlights()
	end
end)

-- Anti Die: visual + optional ForceField if you want (works in studio)
local antiEnabled = false
local function applyAntiToCharacter(char)
	if not char then return end
	local humanoid = char:FindFirstChild("Humanoid") or char:WaitForChild("Humanoid", 5)
	if not humanoid then return end
	-- Optionally add ForceField (uncomment if you want server-sided protection in Studio)
	-- if not char:FindFirstChildOfClass("ForceField") then Instance.new("ForceField", char) end
	humanoid.HealthChanged:Connect(function()
		if antiEnabled and humanoid and humanoid.Health < 1 then
			humanoid.Health = humanoid.MaxHealth
		end
	end)
end

antiDieBtn.MouseButton1Click:Connect(function()
	antiEnabled = not antiEnabled
	antiDieBtn.Text = antiEnabled and "Anti Die : ON" or "Anti Die : OFF"
	if antiEnabled then
		if player.Character then applyAntiToCharacter(player.Character) end
		player.CharacterAdded:Connect(function(c) task.wait(0.5) applyAntiToCharacter(c) end)
	else
		-- remove any visual markers if you created them (none by default)
	end
end)

-- ===== Open / Close hub animation (slide down/up) =====
do
	local opened = false
	local openPos = UDim2.new(0.5, -260, 0.5, -190)
	local closedPos = UDim2.new(0.5, -260, -1.2, 0)

	nmxBtn.MouseButton1Click:Connect(function()
		opened = not opened
		hub.Visible = true
		if opened then
			hub.Position = closedPos
			TweenService:Create(hub, TweenInfo.new(0.36, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = openPos}):Play()
		else
			TweenService:Create(hub, TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Position = closedPos}):Play()
			task.delay(0.30, function() hub.Visible = false end)
		end
	end)
end

-- ===== Tab visual: highlight selected tab =====
local function highlightTab(selected)
	for _, btn in pairs(tabsScroll:GetChildren()) do
		if btn:IsA("TextButton") then
			local stroke = btn:FindFirstChildWhichIsA("UIStroke")
			if btn == selected then
				stroke.Color = Color3.fromRGB(0,255,200)
			else
				stroke.Color = Color3.fromRGB(0,200,255)
			end
		end
	end
end
mainTab.MouseButton1Click:Connect(function() highlightTab(mainTab) end)
discordTab.MouseButton1Click:Connect(function() highlightTab(discordTab) end)
-- start with main highlighted
highlightTab(mainTab)

-- Final: Ready
print("✅ NMX HUB (Studio LocalScript) loaded — vertical slide & tabs ready (clean labels).")
